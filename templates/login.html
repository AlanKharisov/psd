<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Login</title>
</head>
<body style="font-family:system-ui;padding:20px">
<h2>Вход</h2>
<button id="btnGoogle">Войти через Google</button>
<p id="msg"></p>

<script type="module">
    import { auth, googleProvider } from "/static/firebase-config.js";
    import { signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const msg = document.getElementById("msg");

    document.getElementById("btnGoogle").onclick = async () => {
        try {
            const res = await signInWithPopup(auth, googleProvider);
            const idToken = await res.user.getIdToken();

            // отправляем токен в Go -> Go ставит HttpOnly cookie "session"
            const resp = await fetch("/sessionLogin", {
                method: "POST",
                headers: { "Content-Type": "text/plain" },
                body: idToken,
            });

            if (!resp.ok) {
                msg.textContent = "Не удалось создать сессию (sessionLogin).";
                return;
            }

            location.href = "/admin";
        } catch (e) {
            console.error(e);
            msg.textContent = e.message;
        }
    };
</script>
</body>
</html>
